<h3> <%= @product.title %> </h3>

<p> <%= @product.description %> </p>

<h5> Price: <%= number_to_currency(@product.price) %> </h5>

<div>
  <small>
    Added by <%= @product.user&.full_name || '--deleted--' %>
    <%= time_ago_in_words(@product.created_at) %> ago
  </small>
</div>

<div>
  <% if can?(:crud, @product)%>
    <small>
      <%= link_to "Edit", edit_product_path(@product.id) %>
    </small>
    <small>
      <%= link_to "Delete", product_path(@product.id), method: :delete, data: { confirm: "Are you sure you want to delete this product?" } %>
    </small>
  <% end %>
</div>

<section>
  <h3>Reviews</h3>

  <%= form_with(model: [@product, @new_review], local: true) do |form| %>
    <% if @new_review.errors.present? %>
      <p>
        <%= @new_review.errors.full_messages.join(', ') %>
      </p>
    <% end %>

    <div>
      <%= form.text_area(
        :body,
        cols: 50,
        rows: 5,
        placeholder: "Your review...",
      ) %>
    </div>
    <div>
      <%= form.label :rating %>
      <%= form.number_field :rating, min: 1, max: 5, :value=> 5 %>
    </div>
    <%= form.submit "Add Review" %>
  <% end %>

  <ul class="review-list">
    <% @reviews.each do |review| %>
      <li>
        <% review.is_hidden? ? textcolor = "color:lightgray" : textcolor = "color:black" %>
        <p style=<%=textcolor%> >
          <%= review.body %> <br>
          <%= review.rating %> out of 5 <br>
          <% if can?(:hide, review)%>
            <small>
              <%= 
                link_to(
                  "Toggle Hide",
                  hide_path(@product, review),
                  method: :patch,
                  data: {
                    confirm: "Are you sure?"
                  }
                )
              %>
            </small>
            |
          <% end %>
          <% if can?(:crud, review) %>
            <small>
              <%=
                link_to(
                  "Delete",
                  product_review_path(@product, review),
                  method: :delete,
                  data: {
                    confirm: "Are you sure?"
                  }
                )
              %>
            </small>
            |
          <% end %>
          <small>
            Review added by <%= review.user&.full_name || '--deleted--' %>
            <%= time_ago_in_words(review.created_at) %> ago
          </small>
        </p>
      </li>
    <% end %>
  </ul>
</section>